<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>Cahier des charges - {{ specificationBook.title }}</title>
    <style>
        @page {
            margin: 0 0 35px 0;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'DejaVu Sans', 'Helvetica Neue', Arial, sans-serif;
            font-size: 9.5pt;
            line-height: 1.6;
            color: #1a202c;
            background: #ffffff;
        }

        /* Header premium avec logo */
        .page-header {
            background: #ff9a3c;
            padding: 30px 50px;
            color: #1a202c;
            margin-bottom: 0;
            position: relative;
        }

        .header-logo {
            text-align: center;
            margin-bottom: 25px;
            padding-bottom: 20px;
            border-bottom: 3px solid rgba(255, 255, 255, 0.6);
            position: relative;
            z-index: 1;
        }

        .doc-title h1 {
            font-size: 22pt;
            font-weight: 800;
            margin-bottom: 8px;
            color: #1a202c;
            letter-spacing: 2px;
        }

        .doc-title .ref {
            font-size: 10pt;
            color: #1a202c;
            font-weight: 700;
            background: rgba(255, 255, 255, 0.9);
            padding: 5px 15px;
            border-radius: 20px;
            display: inline-block;
        }

        /* Bloc infos entreprise/client/cadre l√©gal - Premium */
        .info-block {
            flex: 1;
            background: rgba(255, 255, 255, 0.98);
            padding: 14px;
            border-radius: 10px;
            border: 2px solid rgba(255, 255, 255, 0.6);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            position: relative;
            z-index: 1;
        }

        .info-block h3 {
            font-size: 9.5pt;
            font-weight: 800;
            margin-bottom: 8px;
            padding-bottom: 6px;
            border-bottom: 2px solid #ff9a3c;
            color: #1a202c;
            letter-spacing: 0.5px;
        }

        .info-block p {
            margin: 3px 0;
            line-height: 1.5;
            color: #1a202c;
            font-size: 8.5pt;
        }

        .info-block p strong {
            font-weight: 700;
            color: #1e293b;
        }

        /* Bandeau projet - Premium */
        .project-banner {
            background: #f8fafc;
            border-left: 6px solid #ff9a3c;
            padding: 20px 50px;
            margin-bottom: 25px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
            position: relative;
        }

        .project-banner::before {
            content: 'üìã';
            position: absolute;
            left: 20px;
            top: 50%;
            transform: translateY(-50%);
            font-size: 24pt;
            opacity: 0.3;
        }

        .project-title {
            font-size: 18pt;
            color: #1a202c;
            font-weight: 800;
            margin-bottom: 8px;
            letter-spacing: 0.5px;
        }

        .project-meta {
            font-size: 9pt;
            color: #64748b;
            font-weight: 500;
        }

        /* Container */
        .container {
            padding: 0 50px 90px 50px;
        }

        /* Table des mati√®res premium */
        .toc {
            background: #f8fafc;
            padding: 20px 25px;
            margin-bottom: 25px;
            border-radius: 12px;
            border: 2px solid #e2e8f0;
            border-top: 5px solid #ff9a3c;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
            position: relative;
        }

        .toc h2 {
            font-size: 13pt;
            color: #1a202c;
            margin-bottom: 12px;
            padding-bottom: 8px;
            border-bottom: 3px solid #ff9a3c;
            font-weight: 800;
            letter-spacing: 0.5px;
        }

        .toc ul {
            list-style: none;
            margin: 0;
            padding: 0;
            column-count: 2;
            column-gap: 30px;
        }

        .toc li {
            padding: 4px 0;
            font-size: 8.5pt;
            color: #475569;
            break-inside: avoid;
            font-weight: 500;
        }

        .toc li:before {
            content: "‚ñ∏ ";
            color: #ff9a3c;
            font-weight: bold;
            margin-right: 6px;
            font-size: 10pt;
        }

        /* Sections premium */
        .section {
            page-break-inside: avoid;
            margin-bottom: 30px;
            background: #ffffff;
            border: 2px solid #e2e8f0;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 4px 16px rgba(0, 0, 0, 0.08);
        }

        .section-header {
            background: #ff9a3c;
            color: #1a202c;
            padding: 12px 20px;
            font-size: 11.5pt;
            font-weight: 800;
            letter-spacing: 0.5px;
            border-bottom: 3px solid #ff6b6b;
        }

        .section-number {
            background: rgba(255, 255, 255, 0.9);
            padding: 3px 10px;
            border-radius: 15px;
            margin-right: 10px;
            font-size: 9.5pt;
            font-weight: 700;
            border: 1px solid rgba(255, 255, 255, 0.6);
            color: #1a202c;
        }

        .section-body {
            padding: 20px;
            background: #ffffff;
        }

        /* Questions premium */
        .question-block {
            margin-bottom: 18px;
            padding-bottom: 18px;
            border-bottom: 2px solid #e2e8f0;
            position: relative;
            padding-left: 15px;
            border-left: 4px solid #ff9a3c;
            page-break-inside: avoid;
        }

        .question-block:last-child {
            border-bottom: none;
            margin-bottom: 0;
            padding-bottom: 0;
        }

        .question {
            font-weight: 700;
            color: #1e293b;
            margin-bottom: 8px;
            font-size: 10pt;
            letter-spacing: 0.3px;
        }

        .answer {
            color: #64748b;
            font-size: 9pt;
            line-height: 1.7;
            padding-left: 10px;
            font-weight: 400;
        }

        .answer.empty {
            color: #cbd5e1;
            font-style: italic;
        }

        .answer strong {
            color: #475569;
            font-weight: 700;
            background: #fef3c7;
            padding: 3px 8px;
            border-radius: 4px;
            border: 1px solid #fbbf24;
        }

        /* Listes premium */
        ul {
            margin: 8px 0 8px 18px;
            padding: 0;
        }

        ul li {
            margin: 4px 0;
            color: #475569;
            font-size: 8.5pt;
            line-height: 1.6;
        }

        ul li::marker {
            color: #ff9a3c;
            font-weight: bold;
        }

        /* Footer premium */
        .page-footer {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: #1e293b;
            color: #f8fafc;
            padding: 10px 50px;
            font-size: 7.5pt;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-top: 3px solid #ff9a3c;
            box-shadow: 0 -4px 12px rgba(0, 0, 0, 0.15);
        }

        .page-footer strong {
            font-weight: 700;
            color: #fbbf24;
        }

        .page-number:after {
            content: counter(page);
            background: #ff9a3c;
            color: #ffffff;
            padding: 2px 8px;
            border-radius: 10px;
            font-weight: 700;
            margin-left: 5px;
        }

        /* Valeurs highlight premium */
        .value-highlight {
            font-size: 10.5pt;
            font-weight: 800;
            color: #ff6b6b;
            background: #fef3c7;
            padding: 4px 10px;
            border-radius: 6px;
            border: 2px solid #fbbf24;
            display: inline-block;
        }

        /* Badge premium */
        .premium-badge {
            position: absolute;
            top: 20px;
            right: 50px;
            background: #fbbf24;
            color: white;
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 7pt;
            font-weight: 800;
            text-transform: uppercase;
            letter-spacing: 1px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
            z-index: 10;
        }
    </style>
</head>
<body>
    <!-- Header premium avec logo -->
    <div class="page-header">
{#        <div class="premium-badge">‚ú® PREMIUM</div>#}
        <div class="header-logo">
            <div class="doc-title">
                <div style="margin-bottom: 15px;">
                    <span style="font-size: 32pt; font-weight: 800; color: #1a202c; letter-spacing: 3px;">| &lt;AS-Turing /&gt;</span>
                </div>
                <h1>CAHIER DES CHARGES</h1>
                <div class="ref">R√©f. CDC-{{ specificationBook.id }} | {{ specificationBook.createdAt|date('d/m/Y') }}</div>
            </div>
        </div>

        <div class="header-blocks">
            <!-- AS-Turing et Client c√¥te √† c√¥te avec table -->
            <table style="width: 100%; margin-bottom: 15px; border-spacing: 12px;">
                <tr>
                    <td style="width: 50%; vertical-align: top;">
                        <div class="info-block">
                            <h3>AS-TURING</h3>
                            <p><strong>Alexandre Sal√©</strong></p>
                            <p>D√©veloppeur Full-Stack</p>
                            <p>contact@as-turing.fr</p>
                            <p>www.as-turing.fr</p>
                        </div>
                    </td>
                    <td style="width: 50%; vertical-align: top;">
                        <div class="info-block">
                            <h3>CLIENT</h3>
                            {% set clientName = '' %}
                            {% set clientEmail = '' %}
                            {% set clientPhone = '' %}
                            {% set clientCompany = '' %}

                            {% for spec in allSpecifications %}
                                {% if spec.displayOrder == 1 and answers[spec.id] is defined %}
                                    {% set clientName = answers[spec.id] %}
                                {% endif %}
                                {% if spec.displayOrder == 2 and answers[spec.id] is defined %}
                                    {% set clientName = clientName ~ ' ' ~ answers[spec.id] %}
                                {% endif %}
                                {% if spec.displayOrder == 3 and answers[spec.id] is defined %}
                                    {% set clientEmail = answers[spec.id] %}
                                {% endif %}
                                {% if spec.displayOrder == 4 and answers[spec.id] is defined %}
                                    {% set clientPhone = answers[spec.id] %}
                                {% endif %}
                                {% if spec.displayOrder == 5 and answers[spec.id] is defined %}
                                    {% set clientCompany = answers[spec.id] %}
                                {% endif %}
                            {% endfor %}

                            <p><strong>{{ clientName|default('Non renseign√©') }}</strong></p>
                            {% if clientCompany %}<p>{{ clientCompany }}</p>{% endif %}
                            {% if clientEmail %}<p>{{ clientEmail }}</p>{% endif %}
                            {% if clientPhone %}<p>{{ clientPhone }}</p>{% endif %}
                        </div>
                    </td>
                </tr>
            </table>

            <!-- Bloc Cadre l√©gal sur toute la largeur -->
            <div class="info-block">
                <h3>CADRE L√âGAL & ENGAGEMENT</h3>
                <p>Ce document d√©finit le p√©rim√®tre pr√©cis du projet et sert de base contractuelle. <strong>Modifications importantes :</strong> Toute √©volution majeure n√©cessitera une r√©-estimation budg√©taire et temporelle formalis√©e par avenant. <strong>Validation :</strong> Signature √©lectronique ou manuscrite requise pour engagement des deux parties.</p>
            </div>
        </div>
    </div>

    <!-- Bandeau projet premium int√©gr√© dans le header orange -->
    <div style="background: #ff9a3c; padding: 0 50px 30px 50px; min-height: 385px">
        <div style="background: rgba(255, 255, 255, 0.95); border-left: 6px solid #1a202c; padding: 20px 30px; border-radius: 8px; box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);">
            <div style="font-size: 18pt; color: #1a202c; font-weight: 800; margin-bottom: 8px; letter-spacing: 0.5px;">
                {{ specificationBook.title }}
            </div>
            {% if specificationBook.description %}
            <div style="font-size: 9pt; color: #64748b; font-weight: 500;">
                <strong>Note :</strong> {{ specificationBook.description }}
            </div>
            {% endif %}
        </div>
    </div>

    <div class="container">
        <!-- Table des mati√®res premium -->
        <div class="toc" style="page-break-before: always; margin-top: 30px;">
            <h2>SOMMAIRE D√âTAILL√â</h2>
            <ul>
                {% set section_count = 0 %}
                {% for sectionName, questionIds in sections %}
                    {% set hasAnswers = false %}
                    {% for spec in allSpecifications %}
                        {% if spec.displayOrder in questionIds and answers[spec.id] is defined and answers[spec.id] %}
                            {% set hasAnswers = true %}
                        {% endif %}
                    {% endfor %}
                    {% if hasAnswers %}
                        {% set section_count = section_count + 1 %}
                        <li>{{ section_count }}. {{ sectionName }}</li>
                    {% endif %}
                {% endfor %}
            </ul>
        </div>

        <!-- Sections -->
        {% set section_count = 0 %}
        <div style="page-break-before: always; page-break-inside: avoid; padding-top: 30px;">
            {% for sectionName, questionIds in sections %}
                {% set hasAnswers = false %}
                {% for spec in allSpecifications %}
                    {% if spec.displayOrder in questionIds and answers[spec.id] is defined and answers[spec.id] %}
                        {% set hasAnswers = true %}
                    {% endif %}
                {% endfor %}

                {% if hasAnswers %}
                    {% set section_count = section_count + 1 %}
                    <div class="section">
                        <div class="section-header">
                            <span class="section-number">{{ section_count }}</span>
                            {{ sectionName }}
                        </div>
                        <div class="section-body">
                            {% for spec in allSpecifications %}
                                {% if spec.displayOrder in questionIds %}
                                    <div class="question-block">
                                        <div class="question">{{ spec.label }}</div>
                                        <div class="answer {% if not answers[spec.id] %}empty{% endif %}">
                                            {% if answers[spec.id] %}
                                                {% set value = answers[spec.id] %}

                                                {# Handle checkbox #}
                                                {% if spec.type == 'checkbox' and value starts with '[' %}
                                                    {% set decodedValues = value|replace({'"': '', '[': '', ']': ''})|split(',') %}
                                                    <ul>
                                                        {% for item in decodedValues %}
                                                            <li>{{ item }}</li>
                                                        {% endfor %}
                                                    </ul>

                                                    {# Handle date #}
                                                {% elseif spec.type == 'date' %}
                                                    <span class="value-highlight">{{ value|date('d/m/Y') }}</span>

                                                    {# Handle number #}
                                                {% elseif spec.type == 'number' %}
                                                    <span class="value-highlight">{{ value|number_format(0, ',', ' ') }} ‚Ç¨</span>

                                                    {# Handle textarea #}
                                                {% elseif spec.type == 'textarea' %}
                                                    {{ value|nl2br|raw }}

                                                    {# Default #}
                                                {% else %}
                                                    <strong>{{ value }}</strong>
                                                {% endif %}
                                            {% else %}
                                                <em>Non renseign√©</em>
                                            {% endif %}
                                        </div>
                                    </div>
                                {% endif %}
                            {% endfor %}
                        </div>
                    </div>
                {% endif %}
            {% endfor %}
        </div>
        <!-- Page CGV premium -->
        <div style="page-break-before: always; page-break-inside: avoid; padding-top: 30px;">
            <div class="section" style="page-break-inside: avoid;">
                <div style="background: #ff9a3c; color: #1a202c; padding: 12px 20px; font-size: 12pt; font-weight: 800; border-radius: 12px 12px 0 0; letter-spacing: 0.5px; border-bottom: 3px solid #ff6b6b;">
                    <span style="background: rgba(255, 255, 255, 0.9); padding: 4px 12px; border-radius: 15px; margin-right: 10px; font-size: 10pt; border: 1px solid rgba(255, 255, 255, 0.6); color: #1a202c;">üìã</span>
                    CONDITIONS G√âN√âRALES & CADRE CONTRACTUEL
                </div>
                <div class="section-body" style="padding: 15px; background: #ffffff;">
                    <div style="background: #fef3c7; border-left: 5px solid #f59e0b; padding: 10px; margin-bottom: 15px; border-radius: 8px; box-shadow: 0 2px 6px rgba(0, 0, 0, 0.1);">
                        <p style="font-size: 8.5pt; color: #78350f; margin: 0; line-height: 1.4; font-weight: 600;">
                            <strong>‚ö†Ô∏è Document contractuel :</strong> Ce cahier des charges constitue un document engageant √©tabli sur la base des informations communiqu√©es lors de nos √©changes.
                            Il d√©finit pr√©cis√©ment le p√©rim√®tre du projet et sert de r√©f√©rence pour l'estimation budg√©taire et les d√©lais.
                        </p>
                    </div>

                    <div style="margin-bottom: 12px; padding-bottom: 12px; border-bottom: 2px solid #e2e8f0;">
                        <div style="font-weight: 800; color: #1e293b; margin-bottom: 4px; font-size: 9.5pt; letter-spacing: 0.3px;">1. Modifications & Avenants</div>
                        <div style="color: #64748b; font-size: 8pt; line-height: 1.35; padding-left: 12px;">
                            Toute demande de modification majeure apr√®s validation du cahier des charges et signature du devis
                            fera l'objet d'un devis compl√©mentaire formalis√© par avenant. Les ajustements mineurs et optimisations
                            sont inclus dans le cadre des it√©rations pr√©vues au contrat initial.
                        </div>
                    </div>

                    <div style="margin-bottom: 12px; padding-bottom: 12px; border-bottom: 2px solid #e2e8f0;">
                        <div style="font-weight: 800; color: #1e293b; margin-bottom: 4px; font-size: 9.5pt; letter-spacing: 0.3px;">2. Tarification & Modalit√©s de Paiement</div>
                        <div style="color: #64748b; font-size: 8pt; line-height: 1.35; padding-left: 12px;">
                            ‚Ä¢ Un <strong style="color: #1e293b;">acompte de 30%</strong> est requis √† la validation du devis pour engager le projet<br>
                            ‚Ä¢ Paiement interm√©diaire de <strong style="color: #1e293b;">40%</strong> √† mi-parcours sur validation des livrables<br>
                            ‚Ä¢ Solde de <strong style="color: #1e293b;">30%</strong> r√©gl√© √† <strong style="color: #1e293b;">30 jours fin de mois</strong> apr√®s livraison finale<br>
                            ‚Ä¢ Facturation transparente selon grille tarifaire ou forfait sur mesure<br>
                            ‚Ä¢ P√©nalit√©s de retard conformes √† la loi (article L.441-10 du Code de commerce)
                        </div>
                    </div>

                    <div style="margin-bottom: 12px; padding-bottom: 12px; border-bottom: 2px solid #e2e8f0;">
                        <div style="font-weight: 800; color: #1e293b; margin-bottom: 4px; font-size: 9.5pt; letter-spacing: 0.3px;">3. Propri√©t√© Intellectuelle & Droits d'Usage</div>
                        <div style="color: #64748b; font-size: 8pt; line-height: 1.35; padding-left: 12px;">
                            Les cr√©ations livr√©es (code source, design, contenus, documentations) sont c√©d√©es avec un droit d'usage
                            complet, exclusif et illimit√© dans le temps. La propri√©t√© intellectuelle est transf√©r√©e au client
                            imm√©diatement apr√®s le paiement int√©gral des sommes dues. Code open-source utilis√© sous licences respectives.
                        </div>
                    </div>

                    <div style="margin-bottom: 12px; padding-bottom: 12px; border-bottom: 2px solid #e2e8f0;">
                        <div style="font-weight: 800; color: #1e293b; margin-bottom: 4px; font-size: 9.5pt; letter-spacing: 0.3px;">4. Confidentialit√© & Protection des Donn√©es</div>
                        <div style="color: #64748b; font-size: 8pt; line-height: 1.35; padding-left: 12px;">
                            AS-Turing s'engage √† une confidentialit√© absolue concernant toutes les donn√©es, informations strat√©giques
                            et √©l√©ments sensibles partag√©s dans le cadre du projet. Conformit√© RGPD garantie.
                            Une clause de non-divulgation (NDA) renforc√©e peut √™tre √©tablie sur simple demande sans frais additionnels.
                        </div>
                    </div>

                    <div style="margin-bottom: 12px; padding-bottom: 12px; border-bottom: 2px solid #e2e8f0;">
                        <div style="font-weight: 800; color: #1e293b; margin-bottom: 4px; font-size: 9.5pt; letter-spacing: 0.3px;">5. D√©lais & Planning de R√©alisation</div>
                        <div style="color: #64748b; font-size: 8pt; line-height: 1.35; padding-left: 12px;">
                            Les d√©lais indiqu√©s dans le devis sont contractuels sous r√©serve de la transmission en temps voulu
                            des √©l√©ments n√©cessaires (contenus, acc√®s, validations interm√©diaires). Un planning d√©taill√© est fourni
                            avec jalons de validation. Les retards imputables au client pourront d√©caler proportionnellement la date de livraison.
                        </div>
                    </div>

                    <div style="margin-bottom: 12px; padding-bottom: 12px; border-bottom: 2px solid #e2e8f0;">
                        <div style="font-weight: 800; color: #1e293b; margin-bottom: 4px; font-size: 9.5pt; letter-spacing: 0.3px;">6. Garantie & Support Technique</div>
                        <div style="color: #64748b; font-size: 8pt; line-height: 1.35; padding-left: 12px;">
                            Garantie de bon fonctionnement de <strong style="color: #1e293b;">3 mois</strong> apr√®s livraison incluant
                            corrections de bugs et ajustements techniques. Support technique prioritaire disponible.
                            AS-Turing ne saurait √™tre tenu responsable des d√©faillances de services tiers (h√©bergeurs, APIs externes)
                            mais assure une assistance pour leur r√©solution.
                        </div>
                    </div>

                    <div style="border-top: 3px solid #ff9a3c; margin-top: 15px; padding-top: 12px; background: #f8fafc;">
                        <p style="font-size: 7.5pt; color: #64748b; text-align: center; margin: 0; line-height: 1.4; font-weight: 600;">
                            <strong style="color: #1e293b; font-size: 8.5pt;">üìÑ CGV compl√®tes disponibles sur :</strong> <span style="color: #ff9a3c; font-weight: 700;">www.as-turing.fr/cgv</span><br>
                            En validant ce cahier des charges, le client reconna√Æt avoir pris connaissance et accepter les pr√©sentes conditions ainsi que les CGV int√©grales d'AS-Turing.
                        </p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Footer premium -->
    <div class="page-footer">
        <div>
            <strong>| &lt;AS-Turing&gt;</AS-Turing></strong> ‚Ä¢ Agence web | contact@as-turing.fr | www .as-turing.fr
        </div>
        <div>
            G√©n√©r√© le {{ "now"|date('d/m/Y √† H:i') }} | Page <span class="page-number"></span>
        </div>
    </div>
</body>
</html>
