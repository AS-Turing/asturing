<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>Cahier des charges - {{ specificationBook.title }}</title>
    <style>
        @page {
            margin: 0 0 30px 0;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'DejaVu Sans', Arial, sans-serif;
            font-size: 9.5pt;
            line-height: 1.5;
            color: #1a202c;
            background: #ffffff;
        }

        /* Header professionnel */
        .page-header {
            background: linear-gradient(135deg, #ff9a3c 0%, #ff6b6b 50%, #c084fc 100%);
            padding: 25px 40px;
            color: #1a202c;
            margin-bottom: 0;
        }

        .header-top {
            text-align: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid rgba(0, 0, 0, 0.2);
        }

        .doc-title h1 {
            font-size: 22pt;
            font-weight: 700;
            margin-bottom: 5px;
            color: #1a202c;
        }

        .doc-title .ref {
            font-size: 10pt;
            color: #1a202c;
        }

        /* Bloc infos entreprise/client/cadre l√©gal */
        .info-block {
            flex: 1;
            background: rgba(255, 255, 255, 0.9);
            padding: 10px;
            border-radius: 6px;
            border: 1px solid rgba(0, 0, 0, 0.1);
        }

        .info-block h3 {
            font-size: 9pt;
            font-weight: 700;
            margin-bottom: 5px;
            padding-bottom: 3px;
            border-bottom: 1px solid rgba(0, 0, 0, 0.2);
            color: #1a202c;
        }

        .info-block p {
            margin: 2px 0;
            line-height: 1.3;
            color: #1a202c;
        }

        /* Bandeau projet */
        .project-banner {
            background: #f8fafc;
            border-left: 5px solid #ff9a3c;
            padding: 15px 40px;
            margin-bottom: 20px;
        }

        .project-title {
            font-size: 16pt;
            color: #1a202c;
            font-weight: 700;
            margin-bottom: 5px;
        }

        .project-meta {
            font-size: 8.5pt;
            color: #64748b;
        }

        /* Container */
        .container {
            padding: 0 40px 80px 40px;
        }

        /* Table des mati√®res compacte */
        .toc {
            background: #f8fafc;
            padding: 15px 20px;
            margin-bottom: 20px;
            border-radius: 6px;
            border: 1px solid #e2e8f0;
        }

        .toc h2 {
            font-size: 12pt;
            color: #1a202c;
            margin-bottom: 10px;
            padding-bottom: 6px;
            border-bottom: 2px solid #ff9a3c;
        }

        .toc ul {
            list-style: none;
            margin: 0;
            padding: 0;
            column-count: 2;
            column-gap: 25px;
        }

        .toc li {
            padding: 2px 0;
            font-size: 8pt;
            color: #475569;
            break-inside: avoid;
        }

        .toc li:before {
            content: "‚ñ∏ ";
            color: #ff9a3c;
            font-weight: bold;
            margin-right: 5px;
        }

        /* Sections */
        .section {
            page-break-inside: avoid;
            margin-bottom: 25px;
            background: #ffffff;
            border: 1px solid #e2e8f0;
            border-radius: 6px;
            overflow: hidden;
        }

        .section-header {
            background: linear-gradient(to right, #ff9a3c, #ff6b6b);
            color: white;
            padding: 8px 15px;
            font-size: 11pt;
            font-weight: 700;
        }

        .section-number {
            background: rgba(255, 255, 255, 0.25);
            padding: 2px 8px;
            border-radius: 12px;
            margin-right: 8px;
            font-size: 9pt;
        }

        .section-body {
            padding: 15px;
        }

        /* Questions */
        .question-block {
            margin-bottom: 15px;
            padding-bottom: 15px;
            border-bottom: 1px solid #e2e8f0;
        }

        .question-block:last-child {
            border-bottom: none;
            margin-bottom: 0;
            padding-bottom: 0;
        }

        .question {
            font-weight: 700;
            color: #1e293b;
            margin-bottom: 6px;
            font-size: 9.5pt;
        }

        .answer {
            color: #64748b;
            font-size: 9pt;
            line-height: 1.6;
            padding-left: 15px;
            font-weight: 400;
        }

        .answer.empty {
            color: #cbd5e1;
            font-style: italic;
        }

        .answer strong {
            color: #475569;
            font-weight: 600;
            background: #f1f5f9;
            padding: 2px 6px;
            border-radius: 3px;
        }

        /* Listes */
        ul {
            margin: 5px 0 5px 15px;
            padding: 0;
        }

        ul li {
            margin: 2px 0;
            color: #475569;
            font-size: 8.5pt;
        }

        /* Footer professionnel */
        .page-footer {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: #1e293b;
            color: white;
            padding: 8px 40px;
            font-size: 7pt;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-top: 2px solid #ff9a3c;
        }

        .page-number:after {
            content: counter(page);
        }

        /* Valeurs highlight */
        .value-highlight {
            font-size: 10pt;
            font-weight: 700;
            color: #ff6b6b;
        }
    </style>
</head>
<body>
    <!-- Header professionnel -->
    <div class="page-header">
        <div class="header-top">
            <div class="doc-title">
                <h1>CAHIER DES CHARGES</h1>
                <div class="ref">R√©f. CDC-{{ specificationBook.id }} | {{ specificationBook.createdAt|date('d/m/Y') }}</div>
            </div>
        </div>

        <div class="header-blocks">
            <!-- AS-Turing et Client c√¥te √† c√¥te avec table -->
            <table style="width: 100%; margin-bottom: 10px; border-spacing: 10px;">
                <tr>
                    <td style="width: 50%; vertical-align: top;">
                        <div class="info-block">
                            <h3>üìç AS-TURING</h3>
                            <p><strong>Alexandre Sirop</strong></p>
                            <p>D√©veloppeur Full-Stack</p>
                            <p>üìß contact@as-turing.fr</p>
                            <p>üåê www.as-turing.fr</p>
                        </div>
                    </td>
                    <td style="width: 50%; vertical-align: top;">
                        <div class="info-block">
                            <h3>üë§ CLIENT</h3>
                            {% set clientName = '' %}
                            {% set clientEmail = '' %}
                            {% set clientPhone = '' %}
                            {% set clientCompany = '' %}

                            {% for spec in allSpecifications %}
                                {% if spec.displayOrder == 1 and answers[spec.id] is defined %}
                                    {% set clientName = answers[spec.id] %}
                                {% endif %}
                                {% if spec.displayOrder == 2 and answers[spec.id] is defined %}
                                    {% set clientName = clientName ~ ' ' ~ answers[spec.id] %}
                                {% endif %}
                                {% if spec.displayOrder == 3 and answers[spec.id] is defined %}
                                    {% set clientEmail = answers[spec.id] %}
                                {% endif %}
                                {% if spec.displayOrder == 4 and answers[spec.id] is defined %}
                                    {% set clientPhone = answers[spec.id] %}
                                {% endif %}
                                {% if spec.displayOrder == 5 and answers[spec.id] is defined %}
                                    {% set clientCompany = answers[spec.id] %}
                                {% endif %}
                            {% endfor %}

                            <p><strong>{{ clientName|default('Non renseign√©') }}</strong></p>
                            {% if clientCompany %}<p>{{ clientCompany }}</p>{% endif %}
                            {% if clientEmail %}<p>üìß {{ clientEmail }}</p>{% endif %}
                            {% if clientPhone %}<p>üì± {{ clientPhone }}</p>{% endif %}
                        </div>
                    </td>
                </tr>
            </table>

            <!-- Bloc Cadre l√©gal sur toute la largeur -->
            <div class="info-block">
                <h3>‚öñÔ∏è CADRE L√âGAL</h3>
                <p>Ce document d√©finit le p√©rim√®tre du projet. <strong>Modifications importantes :</strong> Tout changement majeur n√©cessitera une r√©-estimation du budget et des d√©lais. <strong>Validation :</strong> √Ä l'appr√©ciation d'AS-Turing.</p>
            </div>
        </div>
    </div>

    <!-- Bandeau projet -->
    <div class="project-banner">
        <div class="project-title">{{ specificationBook.title }}</div>
        <div class="project-meta">
            {% if specificationBook.description %}
            <strong>Note :</strong> {{ specificationBook.description }}
            {% endif %}
        </div>
    </div>

    <div class="container">
        <!-- Table des mati√®res -->
        <div class="toc">
            <h2>üìã Sommaire</h2>
            <ul>
                {% set section_count = 0 %}
                {% for sectionName, questionIds in sections %}
                    {% set hasAnswers = false %}
                    {% for spec in allSpecifications %}
                        {% if spec.displayOrder in questionIds and answers[spec.id] is defined and answers[spec.id] %}
                            {% set hasAnswers = true %}
                        {% endif %}
                    {% endfor %}
                    {% if hasAnswers %}
                        {% set section_count = section_count + 1 %}
                        <li>{{ section_count }}. {{ sectionName }}</li>
                    {% endif %}
                {% endfor %}
            </ul>
        </div>

        <!-- Sections -->
        {% set section_count = 0 %}
        {% for sectionName, questionIds in sections %}
            {% set hasAnswers = false %}
            {% for spec in allSpecifications %}
                {% if spec.displayOrder in questionIds and answers[spec.id] is defined and answers[spec.id] %}
                    {% set hasAnswers = true %}
                {% endif %}
            {% endfor %}

            {% if hasAnswers %}
                {% set section_count = section_count + 1 %}
                <div class="section">
                    <div class="section-header">
                        <span class="section-number">{{ section_count }}</span>
                        {{ sectionName }}
                    </div>
                    <div class="section-body">
                        {% for spec in allSpecifications %}
                            {% if spec.displayOrder in questionIds %}
                                <div class="question-block">
                                    <div class="question">{{ spec.label }}</div>
                                    <div class="answer {% if not answers[spec.id] %}empty{% endif %}">
                                        {% if answers[spec.id] %}
                                            {% set value = answers[spec.id] %}

                                            {# Handle checkbox #}
                                            {% if spec.type == 'checkbox' and value starts with '[' %}
                                                {% set decodedValues = value|replace({'"': '', '[': '', ']': ''})|split(',') %}
                                                <ul>
                                                {% for item in decodedValues %}
                                                    <li>{{ item }}</li>
                                                {% endfor %}
                                                </ul>

                                            {# Handle date #}
                                            {% elseif spec.type == 'date' %}
                                                <span class="value-highlight">üìÖ {{ value|date('d/m/Y') }}</span>

                                            {# Handle number #}
                                            {% elseif spec.type == 'number' %}
                                                <span class="value-highlight">üí∞ {{ value|number_format(0, ',', ' ') }} ‚Ç¨</span>

                                            {# Handle textarea #}
                                            {% elseif spec.type == 'textarea' %}
                                                {{ value|nl2br|raw }}

                                            {# Default #}
                                            {% else %}
                                                <strong>{{ value }}</strong>
                                            {% endif %}
                                        {% else %}
                                            <em>Non renseign√©</em>
                                        {% endif %}
                                    </div>
                                </div>
                            {% endif %}
                        {% endfor %}
                    </div>
                </div>
            {% endif %}
        {% endfor %}
        
        <!-- Page CGV -->
        <div style="page-break-before: always; page-break-inside: avoid; padding-top: 40px;">
            <div class="section" style="page-break-inside: avoid;">
                <div style="background: #ff9a3c; color: #1a202c; padding: 8px 15px; font-size: 11pt; font-weight: 700; border-radius: 6px 6px 0 0;">
                    <span style="background: rgba(255, 255, 255, 0.4); padding: 2px 8px; border-radius: 12px; margin-right: 8px; font-size: 9pt;">üìã</span>
                    CONDITIONS G√âN√âRALES & CADRE CONTRACTUEL
                </div>
                <div class="section-body" style="padding: 12px;">
                    <div style="background: #fef3c7; border-left: 4px solid #f59e0b; padding: 8px; margin-bottom: 12px; border-radius: 4px;">
                        <p style="font-size: 8.5pt; color: #78350f; margin: 0; line-height: 1.3;">
                            <strong>‚ö†Ô∏è Important :</strong> Ce cahier des charges est √©tabli sur la base des informations communiqu√©es lors de l'entretien. 
                            Il d√©finit le p√©rim√®tre du projet et sert de r√©f√©rence pour l'estimation budg√©taire.
                        </p>
                    </div>
                    
                    <div style="margin-bottom: 10px; padding-bottom: 10px; border-bottom: 1px solid #e2e8f0;">
                        <div style="font-weight: 700; color: #1e293b; margin-bottom: 3px; font-size: 9pt;">1. Modifications du projet</div>
                        <div style="color: #64748b; font-size: 8pt; line-height: 1.4; padding-left: 10px;">
                            Toute demande de modification majeure apr√®s validation du cahier des charges et signature du devis 
                            pourra faire l'objet d'un devis compl√©mentaire. Les ajustements mineurs sont inclus dans le cadre 
                            des it√©rations pr√©vues au contrat.
                        </div>
                    </div>
                    
                    <div style="margin-bottom: 10px; padding-bottom: 10px; border-bottom: 1px solid #e2e8f0;">
                        <div style="font-weight: 700; color: #1e293b; margin-bottom: 3px; font-size: 9pt;">2. Tarification & modalit√©s de paiement</div>
                        <div style="color: #64748b; font-size: 8pt; line-height: 1.4; padding-left: 10px;">
                            ‚Ä¢ Un <strong>acompte de 30%</strong> est demand√© √† la validation du devis<br>
                            ‚Ä¢ Le solde est r√©gl√© √† <strong>30 jours fin de mois</strong> apr√®s livraison<br>
                            ‚Ä¢ Facturation au forfait selon grille tarifaire ou sur mesure<br>
                            ‚Ä¢ P√©nalit√©s de retard conformes √† la loi (article L.441-10 du Code de commerce)
                        </div>
                    </div>
                    
                    <div style="margin-bottom: 10px; padding-bottom: 10px; border-bottom: 1px solid #e2e8f0;">
                        <div style="font-weight: 700; color: #1e293b; margin-bottom: 3px; font-size: 9pt;">3. Propri√©t√© intellectuelle</div>
                        <div style="color: #64748b; font-size: 8pt; line-height: 1.4; padding-left: 10px;">
                            Les cr√©ations livr√©es (code, design, contenus) sont c√©d√©es avec un droit d'usage complet et non exclusif. 
                            La propri√©t√© intellectuelle reste celle d'AS-Turing jusqu'au paiement int√©gral des sommes dues.
                        </div>
                    </div>
                    
                    <div style="margin-bottom: 10px; padding-bottom: 10px; border-bottom: 1px solid #e2e8f0;">
                        <div style="font-weight: 700; color: #1e293b; margin-bottom: 3px; font-size: 9pt;">4. Confidentialit√©</div>
                        <div style="color: #64748b; font-size: 8pt; line-height: 1.4; padding-left: 10px;">
                            AS-Turing s'engage √† la confidentialit√© totale des donn√©es partag√©es dans le cadre du projet. 
                            Une clause de non-divulgation (NDA) peut √™tre √©tablie sur simple demande.
                        </div>
                    </div>
                    
                    <div style="margin-bottom: 10px; padding-bottom: 10px; border-bottom: 1px solid #e2e8f0;">
                        <div style="font-weight: 700; color: #1e293b; margin-bottom: 3px; font-size: 9pt;">5. D√©lais de r√©alisation</div>
                        <div style="color: #64748b; font-size: 8pt; line-height: 1.4; padding-left: 10px;">
                            Les d√©lais indiqu√©s dans le devis sont indicatifs et peuvent varier selon la disponibilit√© du client 
                            √† fournir les √©l√©ments n√©cessaires (contenus, acc√®s, validations). Les retards caus√©s par le client 
                            pourront d√©caler la date de livraison finale.
                        </div>
                    </div>
                    
                    <div style="margin-bottom: 10px; padding-bottom: 10px; border-bottom: 1px solid #e2e8f0;">
                        <div style="font-weight: 700; color: #1e293b; margin-bottom: 3px; font-size: 9pt;">6. Limitation de responsabilit√©</div>
                        <div style="color: #64748b; font-size: 8pt; line-height: 1.4; padding-left: 10px;">
                            AS-Turing ne saurait √™tre tenu responsable en cas de d√©faillance de services tiers 
                            (h√©bergement, plugins, modules externes) utilis√©s dans le cadre du projet. Une assistance 
                            technique reste assur√©e dans les limites contractuelles.
                        </div>
                    </div>
                    
                    <div style="border-top: 2px solid #e2e8f0; margin-top: 12px; padding-top: 10px;">
                        <p style="font-size: 7.5pt; color: #64748b; text-align: center; margin: 0; line-height: 1.3;">
                            <strong>CGV compl√®tes disponibles sur :</strong> www.as-turing.fr/cgv<br>
                            En validant ce cahier des charges, le client accepte les pr√©sentes conditions et les CGV d'AS-Turing.
                        </p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <div class="page-footer">
        <div>
            <strong>AS-Turing</strong> - D√©veloppement Web | contact@as-turing.fr
        </div>
        <div>
            G√©n√©r√© le {{ "now"|date('d/m/Y √† H:i') }} | Page <span class="page-number"></span>
        </div>
    </div>
</body>
</html>
