# ================================
# Docker Compose Override - PRODUCTION
# À placer sur le serveur : /srv/www/asturing/prod/docker-compose.override.yml
# ================================

networks:
  traefik:
    external: true

services:
  nuxt:
    container_name: asturing-prod-nuxt
    restart: unless-stopped
    build:
      dockerfile: Dockerfile
    networks:
      - traefik
    labels:
      - "traefik.enable=true"
      - "traefik.http.routers.asturing-prod-front.rule=Host(`www.as-turing.fr`) || Host(`as-turing.fr`)"
      - "traefik.http.routers.asturing-prod-front.entrypoints=web"
      - "traefik.http.services.asturing-prod-front.loadbalancer.server.port=3000"
      # HTTPS (si configuré)
      - "traefik.http.routers.asturing-prod-front-secure.rule=Host(`www.as-turing.fr`) || Host(`as-turing.fr`)"
      - "traefik.http.routers.asturing-prod-front-secure.entrypoints=websecure"
      - "traefik.http.routers.asturing-prod-front-secure.tls=true"
    environment:
      NUXT_PUBLIC_API_BASE: /api
      API_BASE_URL: http://symfony
      NODE_ENV: production
    volumes: []  # Pas de volumes en prod

  symfony:
    container_name: asturing-prod-symfony
    restart: unless-stopped
    build:
      dockerfile: Dockerfile
    networks:
      - traefik
    labels:
      - "traefik.enable=true"
      - "traefik.http.routers.asturing-prod-backend.rule=Host(`www.as-turing.fr`) && PathPrefix(`/api`)"
      - "traefik.http.routers.asturing-prod-backend.entrypoints=web"
      - "traefik.http.services.asturing-prod-backend.loadbalancer.server.port=80"
      # HTTPS
      - "traefik.http.routers.asturing-prod-backend-secure.rule=Host(`www.as-turing.fr`) && PathPrefix(`/api`)"
      - "traefik.http.routers.asturing-prod-backend-secure.entrypoints=websecure"
      - "traefik.http.routers.asturing-prod-backend-secure.tls=true"
    environment:
      APP_ENV: prod
      APP_DEBUG: 0
    volumes: []  # Pas de volumes en prod

  mysql:
    container_name: asturing-prod-mysql
    restart: unless-stopped
    volumes:
      - asturing_prod_db_data:/var/lib/mysql

volumes:
  asturing_prod_db_data:
